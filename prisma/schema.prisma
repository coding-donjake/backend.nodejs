// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Admin {
  id       String      @id @default(uuid())
  role     AdminRole
  status   AdminStatus @default(ok)
  User     User?       @relation(fields: [userId], references: [id])
  userId   String      @unique
  AdminLog AdminLog[]
}

model AdminLog {
  id         String   @id @default(uuid())
  datetime   DateTime @default(now())
  type       String   @db.VarChar(20)
  content    Json     @db.Json
  Admin      Admin?   @relation(fields: [adminId], references: [id])
  adminId    String?
  Operator   User?    @relation("Operator", fields: [operatorId], references: [id])
  operatorId String?
}

enum AdminRole {
  admin
  staff
}

enum AdminStatus {
  ok
  removed
}

model Asset {
  id         String      @id @default(uuid())
  name       String      @db.VarChar(255)
  brand      String      @db.VarChar(255)
  type       String      @db.VarChar(20)
  serialCode String      @db.VarChar(255)
  status     AssetStatus @default(good)
  Borrowing  Borrowing[]
  AssetLog   AssetLog[]
}

model AssetLog {
  id         String   @id @default(uuid())
  datetime   DateTime @default(now())
  type       String   @db.VarChar(20)
  content    Json     @db.Json
  Asset      Asset?   @relation(fields: [assetId], references: [id])
  assetId    String?
  Operator   User?    @relation("Operator", fields: [operatorId], references: [id])
  operatorId String?
}

enum AssetStatus {
  good
  broken
  removed
}

model Borrowing {
  id               String          @id @default(uuid())
  datetimeBorrowed DateTime?
  datetimeReturned DateTime?
  remarksBorrowed  String?         @db.Text
  remarksReturned  String?         @db.Text
  duration         Int
  status           BorrowingStatus @default(pending)
  Asset            Asset?          @relation(fields: [assetId], references: [id])
  assetId          String?
  User             User?           @relation(fields: [userId], references: [id])
  userId           String?
  BorrowingLog     BorrowingLog[]
}

model BorrowingLog {
  id          String     @id @default(uuid())
  datetime    DateTime   @default(now())
  type        String     @db.VarChar(20)
  content     Json       @db.Json
  Borrowing   Borrowing? @relation(fields: [borrowingId], references: [id])
  borrowingId String?
  Operator    User?      @relation("Operator", fields: [operatorId], references: [id])
  operatorId  String?
}

enum BorrowingStatus {
  pending
  active
  completed
  declined
  removed
}

model User {
  id                         String               @id @default(uuid())
  username                   String               @unique @default(uuid())
  password                   String               @db.VarChar(255)
  status                     UserStatus           @default(unverified)
  UserInformation            UserInformation?
  Admin                      Admin?
  Borrowing                  Borrowing[]
  UserLog                    UserLog[]
  AdminLogOperator           AdminLog[]           @relation("Operator")
  AssetLogOperator           AssetLog[]           @relation("Operator")
  BorrowingLogOperator       BorrowingLog[]       @relation("Operator")
  UserLogOperator            UserLog[]            @relation("Operator")
  UserInformationLogOperator UserInformationLog[] @relation("Operator")
}

model UserLog {
  id         String   @id @default(uuid())
  datetime   DateTime @default(now())
  type       String   @db.VarChar(20)
  content    Json     @db.Json
  User       User?    @relation(fields: [userId], references: [id])
  userId     String?
  Operator   User?    @relation("Operator", fields: [operatorId], references: [id])
  operatorId String?
}

enum UserStatus {
  nur
  unverified
  ok
  deactivated
  removed
  suspended
}

model UserInformation {
  id                 String               @id @default(uuid())
  lastname           String               @db.VarChar(255)
  firstname          String               @db.VarChar(255)
  middlename         String               @db.VarChar(255)
  suffix             String               @db.VarChar(20)
  gender             Gender
  birthdate          DateTime             @db.Date
  User               User?                @relation(fields: [userId], references: [id])
  userId             String               @unique
  UserInformationLog UserInformationLog[]
}

model UserInformationLog {
  id                String           @id @default(uuid())
  datetime          DateTime         @default(now())
  type              String           @db.VarChar(20)
  content           Json             @db.Json
  UserInformation   UserInformation? @relation(fields: [userInformationId], references: [id])
  userInformationId String?
  Operator          User?            @relation("Operator", fields: [operatorId], references: [id])
  operatorId        String?
}

enum Gender {
  male
  female
}
